# 今後の機能追加・改善項目

## 現在の実装状況

### ✅ 実装済み
- CSVからのデータインポート機能
- Supabaseへのデータ保存（冪等性あり）
- 電話番号の自動正規化（E.164形式）
- 時間帯指定（朝・昼・晩）でのランダム時刻生成
- **テスト用**: 具体的な時刻指定（HH:MM形式）
- Twilioを使った自動発信機能
- 推しライバーごとの音声ファイル分岐
- DRY RUNモード（テスト用）
- 発信済みデータの重複防止

### 📝 仕様確認事項
- **本番運用**: CSVで「朝」「昼」「晩」を指定すると、その時間帯内でランダムな時刻に自動発信
- **テスト時**: 「17:30」のように具体的な時刻を指定して即座にテスト可能

---

## 🚀 今後の機能追加項目

### 1. 定期実行の自動化（必須）

**目的**: 手動で `python main.py execute` を実行しなくても、自動的に発信処理が走るようにする

**選択肢**:
- [ ] **GitHub Actions** で定期実行（完全無料、推奨）
- [ ] **Render Cron Jobs** で定期実行
- [ ] **AWS Lambda + EventBridge** でサーバーレス実行
- [ ] その他のサービス（Heroku Scheduler、Railway等）

**実装内容**:
- `.github/workflows/schedule.yml` の作成（GitHub Actionsの場合）
- 5〜15分間隔での定期実行設定
- 環境変数（Secrets）の設定

---

### 2. 管理画面・ダッシュボード（オプション）

**目的**: CSVを手動で編集せず、Web UIから予約管理できるようにする

**機能案**:
- [ ] 予約一覧の表示（発信済み・待機中・エラーのフィルタ）
- [ ] 新規予約の追加（フォーム入力）
- [ ] 予約の編集・削除
- [ ] 発信履歴の確認
- [ ] エラーログの表示

**技術スタック案**:
- Streamlit（Python製、簡単）
- Flask + Bootstrap（軽量）
- Next.js + Supabase（モダン）

---

### 3. エラーハンドリングの強化

**目的**: 発信失敗時の自動リトライや通知機能

**機能案**:
- [ ] 発信失敗時の自動リトライ（最大3回まで等）
- [ ] エラー発生時のメール/Slack通知
- [ ] 音声URLが無効な場合の事前チェック
- [ ] 電話番号の妥当性検証（国際番号フォーマット）

---

### 4. ログ・監視機能

**目的**: システムの稼働状況を可視化

**機能案**:
- [ ] 発信成功率のダッシュボード
- [ ] 日次/週次レポートの自動生成
- [ ] Supabaseのログテーブル追加（詳細な発信履歴）
- [ ] Twilioの通話ステータス取得（応答したか、何秒話したか等）

---

### 5. スケーラビリティ対応

**目的**: 大量の予約に対応

**機能案**:
- [ ] バッチ処理の最適化（1回の実行で複数件を並列処理）
- [ ] Twilioのレート制限対策（発信間隔の調整）
- [ ] 音声ファイルのCDN配信（Supabase Storage → CloudFlare等）

---

### 6. セキュリティ強化

**目的**: 本番運用時の安全性向上

**機能案**:
- [ ] 管理画面へのBasic認証 or OAuth
- [ ] APIキーのローテーション機能
- [ ] 個人情報（電話番号）の暗号化保存
- [ ] アクセスログの記録

---

### 7. 多言語対応（将来的）

**目的**: 日本語以外の音声にも対応

**機能案**:
- [ ] CSVに `language` カラムを追加
- [ ] 言語ごとの音声マッピング
- [ ] Twilioの `<Say>` タグでの多言語読み上げ

---

### 8. テスト自動化

**目的**: コード変更時の品質保証

**機能案**:
- [ ] pytest でのユニットテスト
- [ ] Twilio Test Credentials を使ったE2Eテスト
- [ ] CI/CDパイプラインの構築（GitHub Actions）

---

## 🔧 技術的改善項目

### コード品質
- [ ] 型ヒント（Type Hints）の追加
- [ ] Docstringの充実
- [ ] Linter（Ruff, Black）の導入
- [ ] 設定ファイルの外部化（config.yaml等）

### パフォーマンス
- [ ] データベースクエリの最適化（インデックス活用）
- [ ] 非同期処理の導入（asyncio + httpx）

### 保守性
- [ ] ロギングフレームワークの導入（loguru等）
- [ ] 環境ごとの設定分離（dev/staging/prod）

---

## 📅 優先順位（推奨）

### Phase 1: 最小限の本番運用（必須）
1. ✅ 基本機能の実装（完了）
2. 🔲 定期実行の自動化（GitHub Actions or Render Cron）
3. 🔲 TwiML Binの設定完了
4. 🔲 本番データでのテスト実施

### Phase 2: 運用改善
1. エラーハンドリング強化
2. ログ・監視機能
3. 管理画面（簡易版）

### Phase 3: スケールアップ
1. 大量データ対応
2. セキュリティ強化
3. テスト自動化

---

## 📝 メモ

- 現在の実装は「朝・昼・晩」のランダム発信に対応済み
- テスト時は「17:30」のような具体的時刻指定も可能（両立）
- 音声ファイルはSupabase Storageで管理中
- TwiML BinでTwilioとの連携を実現

---

**最終更新**: 2025-12-09
